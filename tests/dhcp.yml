---
- name: Internal Verification
  hosts: all
  become: yes
  gather_facts: yes
  tasks:
  - name: check if dhcp is installed
    apt:
      name: isc-dhcp-server
      state: present
    check_mode: yes
    register: stat_result
    failed_when: stat_result.changed

  - name: check if isc-dhcp-server is running
    service:
      name: isc-dhcp-server
      state: started
      enabled: true
    check_mode: yes
    register: service_result
    failed_when: service_result.changed

  - name: Check if interface is set to eth1
    lineinfile:
      dest: /etc/default/isc-dhcp-server
      line: 'INTERFACESv4="eth1"'
      regexp: '^INTERFACESv4='
    check_mode: yes
    register: interface_result
    failed_when: interface_result.changed

- name: External Verification
  hosts: all
  become: yes
  gather_facts: yes
  tasks:
    - name: Update Cache
      local_action: 
        module: apt
        update_cache: yes
        cache_valid_time: 3600
      run_once: true

    - name: Install dhcping
      local_action: 
        module: apt
        name: 
          - dhcping
          - bootp
      run_once: true

    - name: Test dhcp with dhcping
      local_action: command dhcping -V -i -s {{ ansible_default_ipv4.address }} -h "00:11:22:33:44:09"
      register: dhcping_results

    - name: dhcping result
      debug:
        var: dhcping_results
...
